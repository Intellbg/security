{% load static %}
<div id="blockModal" class="modal fade modal-md" role="dialog">
  <div class="modal-dialog">
    <input type="hidden" name="id" value="" />
    <input type="hidden" name="is_blocked" value="" />
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">
          &times;
        </button>
        <div style="clear: both"></div>
      </div>
      <div class="modal-body">
        <p name="block_msg" value="">
        </p>
        <div class="form-group col-md-10 col-sm-10"></div>
        <div style="clear: both"></div>
        <div id="blockHouseStatusMessage"></div>
      </div>
      <div class="modal-footer">
        <button type="submit" id="blockButton" class="btn">
          Bloquear
        </button>
        <button type="button" class="btn btn-default" data-dismiss="modal">
          Cerrar
        </button>
      </div>
    </div>
  </div>

  <script type="text/javascript">
    $(document).ready(function () {
      $("#blockModal").on("hidden.bs.modal", function () {
        $("#blockHouseStatusMessage").hide();
      })
      $("#blockButton").click(function () {
        var id = $('#blockModal input[name="id"]').val();
        var is_blocked = $('#blockModal input[name="is_blocked"]').val();
        const showError = (id, xhr) => {
          const { responseJSON } = xhr;
          const getError = () => {
            if (responseJSON) {
              let errors = "";
              for (const [key, value] of Object.entries(responseJSON)) {
                errors = errors + value[0];
              }
              return errors;
            }
            return false;
          };
          const error = getError();
          $(`#${id}`)
            .text(error || "Ha ocurrido un error")
            .addClass("alert alert-danger text-center mt-3")
            .show();
        };
        const getBlockStatus = () => (is_blocked === "true" ? false : true);
        $.ajax({
          url: `/api/v3/households/${id}/`,
          method: "PATCH",
          data: JSON.stringify({ is_blocked: getBlockStatus(), }),
          headers: {
            "X-CSRFToken": "{{ csrf_token }}",
          },
          dataType: "json",
          contentType: "application/json",
          success: function (data) {
            $("#blockModal").modal("hide");
            $("#myTable").DataTable().ajax.reload();
          },
          error: (xhr, status, error) => {
            showError("blockHouseStatusMessage", xhr);
          },
        });
      });
    });
  </script>
</div>
