{% load static %}

<div id="rejectPersonModal" class="modal fade modal-md" role="dialog">
  <div class="modal-dialog">
    <form id="rejectPersonForm">
      <input type="text" name="id" id="id" value="" />
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">
            &times;
          </button>
          <div style="clear: both"></div>
        </div>
        <div class="modal-body">
          <p>
            Si completa la acción se rechazará la solicitud del usuario
            <strong class="text-danger" name="lbl_username"></strong>.
            <br />
            <strong>¿Está seguro?</strong>
          </p>
          <div style="clear: both"></div>
          <div id="rejectCustumerStatusMessage"></div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-danger">Rechazar</button>
          <button type="button" class="btn btn-default" data-dismiss="modal">
            Cerrar
          </button>
        </div>
      </div>
    </form>
  </div>
  <script src="{% static 'js/sb-admin.min.js' %}"></script>
  <script type="text/javascript">
    $(document).ready(() => {

      $("#rejectPersonModal").on("hidden.bs.modal", function () {
        $("#rejectCustumerStatusMessage").hide();
      });
      $("#rejectPersonForm").submit((event) => {
        event.preventDefault();
        const customerSiteId = $('#id').val();
        const showError = (id, xhr) => {
          const { responseJSON } = xhr;
          const getError = () => {
            if (responseJSON) {
              let errors = "";
              for (const [key, value] of Object.entries(responseJSON)) {
                errors = errors + value[0];
              }
              return errors;
            }
            return false;
          };
          const error = getError();
          $(`#${id}`)
            .text(error || "Ha ocurrido un error")
            .addClass("alert alert-danger text-center mt-3")
            .show();
        };

        $.ajax({
          url: `/api/v3/user-site/delete/${customerSiteId}/`,
          type: "DELETE",
          headers: {
            "X-CSRFToken": "{{ csrf_token }}",
          },
          dataType: "json",
          contentType: "application/json",
          success: function (data) {
            $("#rejectPersonModal").modal("hide");
            $("#myTable").DataTable().ajax.reload();
          },
          error: (xhr, status, error) => {
            showError("rejectCustumerStatusMessage", xhr);
          },
        });
      });
    });

  </script>
</div>